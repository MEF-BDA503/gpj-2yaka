```{r, echo=FALSE}
multiplot <- function(..., plotlist = NULL, file, cols = 1, layout = NULL) {
  require(grid)

  plots <- c(list(...), plotlist)

  numPlots = length(plots)

  if (is.null(layout)) {
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                 ncol = cols, nrow = ceiling(numPlots/cols))
}

if (numPlots == 1) {
print(plots[[1]])

} else {
grid.newpage()
pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))

for (i in 1:numPlots) {
  matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))

  print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                  layout.pos.col = matchidx$col))
 }
}
 }
```

# Explanatory Data Analysis on HR Data

## Preparation
We start by loading required libraries for this study. 
```{r, message=FALSE}
library('tidyverse')
library("ggplot2")
```


### Loading the Data
Then we read dataset from csv file and had a quick look at its form. 
```{r}
d=read.csv("HR_comma_sep.csv")
d<- d %>% rename("departments" = "sales")
glimpse(d)

```
As you can see we have 14999 observations for job satisfaction level, latest evaluation (yearly), number of projects worked on, average monthly hours, time spend in the company (in years), work accident (within the past 2 years), promotion within the past 5 years, department and salary. All of them are numeric values except last two columns.


```{r}
summary(d)
```
On average, the employees are 64% satisfied with their jobs; they have mean performance score of 0.71 (out of 1); an ordinary employee worked roughly on 3 - 4 different projects per year; it takes them 201.1 hours to complete their jobs per month; an avarage employee worked almost 3.5 years in the company (min = 2, max = 10); attrition rate is 23.81%; unfortunately only 2.1% of employees were promoted in the last 5 years. 8.24% of the employees are highly paid, 48.78% is lowly paid, 42.98% gets medium wage.

Having known all the column names and their related statistics, we wanted to visualize the distribution of the numerical ones, just the get better understanding for further interpretations. For this reason we employed histogram plots. Notice that bin size is chosen with respect to range of the data.

```{r}
p1 <- ggplot(subset(d ), aes(x=d$satisfaction_level, colour=d$satisfaction_level)) +
  geom_histogram(binwidth = 0.05,color = 'black', fill = '#099DD9') +
  ggtitle("Satisfaction Level") +
  labs(x="Job Satisfaction Score", y="Employee Count")

p2 <- ggplot(subset(d ), aes(x=d$last_evaluation, colour=d$last_evaluation)) +
  geom_histogram(binwidth = 0.05,color = 'black', fill = '#FF8C00') +
  ggtitle("Last Evaluation") +
  labs(x="Performance Score", y="Employee Count")

p3 <- ggplot(subset(d ), aes(x=d$number_project, colour=d$number_project)) +
  geom_histogram(binwidth = 1,color = 'black', fill = '#9932CC') +
  ggtitle("Yearly Projects") +
  labs(x="Number of Projects", y="Employee Count")

p4 <- ggplot(subset(d ), aes(x=d$average_montly_hours, colour=d$average_montly_hours)) +
  geom_histogram(binwidth = 10,color = 'black', fill = '#808000') +
  ggtitle("Average Monthly Hours")+
  labs(x="Monthly Hours", y="Employee Count")
  

p5 <- ggplot(subset(d ), aes(x=d$time_spend_company, colour=d$time_spend_company)) +
  geom_histogram(binwidth = 0.5,color = 'black', fill = '#9932CC') +
  ggtitle("Time Spent in the Company") +
  labs(x="Time (Years)", y="Employee Count")

p6 <- ggplot(subset(d ), aes(x=d$Work_accident, colour=d$Work_accident)) +
  geom_bar(color = 'black', fill = '#9932CC') +
  ggtitle("Work Accidents") +
  labs(x="Accident Count", y="Employee Count")

p7 <- ggplot(subset(d ), aes(x=d$left, colour=d$left)) +
  geom_bar(color = 'black', fill = '#2E8B57') +
  ggtitle("Employees Left") +
  labs(x="Left Count", y="Employee Count")


p8 <- ggplot(subset(d ), aes(x=d$promotion_last_5years, colour=d$promotion_last_5years)) +
  geom_bar(color = 'black', fill = '#00BFFF') +
  ggtitle("Promotion in Last 5 Years") +
  labs(x="Promotion Count", y="Employee Count")


multiplot(p1,p2,p3,p4,p5,p6,p7,p8,cols=4)
```

According to above histograms, we found that; there was nearly no promoted employee in the last five years. Bear in mind that the work accident data belongs to last two years and frequency of accidents is low but not zero. Monthly time spent in the company and number of projects which each employee works on both have positively skewed distributions.

```{r}

# l <- list()
# 
# for (colNames in names(d)) { 
#    l <- ggplot(subset(d ), aes(x=d$colNames, colour=d$colNames)) +
#   geom_histogram(binwidth = 0.05,color = 'black', fill = '#099DD9') +
#   ggtitle(colNames)
#    
#     index = index +1
# }

```

```{r}
# for (i in names(d)) { 
#     print(ggplot(subset(d ), aes(x=d[i], colour=d$i)) +
#   geom_histogram(binwidth = 0.05,color = 'black', fill = '#9932CC') +
#   ggtitle("Last Evaluation") )
# }
```

Now, let's look at the categorical variables, salary and department name. We wanted to compare left and none-left employee counts by departments and salary categories. When salary category does not give much insight about the characteristics of left people, we found that the 3 departments have considerably higher number of people left. These departments are sales, technical and support.
```{r}

p9 <- ggplot(d, aes(x=d$departments,fill=as.character(d$left) ))+
  theme(axis.text.x = element_text(angle = 60, hjust=1))+
  geom_bar()

p10 <- ggplot(d, aes(x=d$salary,fill=as.character(d$left) ))+
      geom_bar()
#ggtitle("Average bill for 2 people")

multiplot(p9,p10,cols=2)


```


```{r}

 ggplot(data=d, aes(x=departments, y=satisfaction_level)) +
 geom_bar(stat="identity", position=position_dodge())

# ggplot(d, aes(x=salary, y=satisfaction_level)) +
#   geom_point(size=2, shape=23)
```
```{r}
department_left_rate<-d %>%
  group_by(departments) %>%
  summarise (n = n()) %>%
  mutate(freq = n / sum(n))

department_left_rate


ggplot(department_left_rate, aes(x=department_left_rate$departments,y=department_left_rate$freq ))+
      theme(axis.text.x = element_text(angle = 60, hjust=1))+
      geom_bar(stat = "identity")

```

