```{r, echo=FALSE}
multiplot <- function(..., plotlist = NULL, file, cols = 1, layout = NULL) {
  require(grid)

  plots <- c(list(...), plotlist)

  numPlots = length(plots)

  if (is.null(layout)) {
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                 ncol = cols, nrow = ceiling(numPlots/cols))
}

if (numPlots == 1) {
print(plots[[1]])

} else {
grid.newpage()
pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))

for (i in 1:numPlots) {
  matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))

  print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                  layout.pos.col = matchidx$col))
 }
}
 }
```

# Explanatory Data Analysis on HR Data

## Preparation
We start by loading required libraries for this study. 
```{r, message=FALSE}
library('tidyverse')
library("ggplot2")
```


### Loading the Data
Then we read dataset from csv file and had a quick look at its form. 
```{r}
d=read.csv("HR_comma_sep.csv")
d<- d %>% rename("departments" = "sales")
glimpse(d)

```
As you can see we have 14999 observations for job satisfaction level, latest evaluation (yearly), number of projects worked on, average monthly hours, time spend in the company (in years), work accident (within the past 2 years), promotion within the past 5 years, department and salary. All of them are numeric values except last two columns.

We also checked whether is there any NA or NaN values.
```{r}
which(is.na.data.frame(d))
```
Since there aren't any NA/NaN values, no need to omit or complete them. Thus we proceed summarizing the data.


```{r}
summary(d)
```
On average, the employees are 64% satisfied with their jobs; they have mean performance score of 0.71 (out of 1); an ordinary employee worked roughly on 3 - 4 different projects per year; it takes them 201.1 hours to complete their jobs per month; an avarage employee worked almost 3.5 years in the company (min = 2, max = 10); attrition rate is 23.81%; unfortunately only 2.1% of employees were promoted in the last 5 years. 8.24% of the employees are highly paid, 48.78% is lowly paid, 42.98% gets medium wage.

Having known all the column names and their related statistics, we wanted to visualize the distribution of the numerical ones, just the get better understanding for further interpretations. For this reason we employed histogram plots. Notice that bin size is chosen with respect to range of the data.

```{r}
p1 <- ggplot(subset(d ), aes(x=d$satisfaction_level, colour=d$satisfaction_level)) +
  geom_histogram(binwidth = 0.05,color = 'black', fill = '#099DD9') +
  ggtitle("Satisfaction Level") +
  labs(x="Job Satisfaction Score", y="Employee Count")

p2 <- ggplot(subset(d ), aes(x=d$last_evaluation, colour=d$last_evaluation)) +
  geom_histogram(binwidth = 0.05,color = 'black', fill = '#FF8C00') +
  ggtitle("Last Evaluation") +
  labs(x="Performance Score", y="Employee Count")

p3 <- ggplot(subset(d ), aes(x=d$number_project, colour=d$number_project)) +
  geom_histogram(binwidth = 1,color = 'black', fill = '#9932CC') +
  ggtitle("Yearly Projects") +
  labs(x="Number of Projects", y="Employee Count")

p4 <- ggplot(subset(d ), aes(x=d$average_montly_hours, colour=d$average_montly_hours)) +
  geom_histogram(binwidth = 10,color = 'black', fill = '#808000') +
  ggtitle("Average Monthly Hours")+
  labs(x="Monthly Hours", y="Employee Count")
  

p5 <- ggplot(subset(d ), aes(x=d$time_spend_company, colour=d$time_spend_company)) +
  geom_histogram(binwidth = 0.5,color = 'black', fill = '#9932CC') +
  ggtitle("Time Spent in the Company") +
  labs(x="Time (Years)", y="Employee Count")

p6 <- ggplot(subset(d ), aes(x=d$Work_accident, colour=d$Work_accident)) +
  geom_bar(color = 'black', fill = '#9932CC') +
  ggtitle("Work Accidents") +
  labs(x="Accident Count", y="Employee Count")

p7 <- ggplot(subset(d ), aes(x=d$left, colour=d$left)) +
  geom_bar(color = 'black', fill = '#2E8B57') +
  ggtitle("Employees Left") +
  labs(x="Left Count", y="Employee Count")


p8 <- ggplot(subset(d ), aes(x=d$promotion_last_5years, colour=d$promotion_last_5years)) +
  geom_bar(color = 'black', fill = '#00BFFF') +
  ggtitle("Promotion in Last 5 Years") +
  labs(x="Promotion Count", y="Employee Count")


multiplot(p1,p2,p3,p4,p5,p6,p7,p8,cols=4)
```

According to above histograms, we found that; there was nearly no promoted employee in the last five years. Bear in mind that the work accident data belongs to last two years and frequency of accidents is low but not zero. Monthly time spent in the company and number of projects which each employee works on both have positively skewed distributions. So, instead of mean, median value must be considered. A common employee works 4 project per year, spending 200 hours per month.

```{r, echo=FALSE, eval=FALSE}
pltList <- list()
name <- names(d)
index = 1
for (colName in names(d)) { 
    pltList[[index]] <- ggplot(d$colName,colour=d$colName) +
    geom_histogram(binwidth = 0.5,color = 'black', fill = '#9932CC') +
    ggtitle(colName) +
    labs(x= name[index], y="Employee Count")
    index = index + 1
}
multiplot(plotlist = pltList,cols = 2)

```

```{r}
# for (i in names(d)) { 
#     print(ggplot(subset(d ), aes(x=d[i], colour=d$i)) +
#   geom_histogram(binwidth = 0.05,color = 'black', fill = '#9932CC') +
#   ggtitle("Last Evaluation") )
# }
```
Let's have a look at departmentwise job satisfaction level of the employees.

```{r}
 dep_satis <- d %>%
  group_by(departments) %>%
  summarise (Satisfaction =mean(satisfaction_level))
  ggplot(data=dep_satis, aes(x=departments, y=Satisfaction)) +
  theme(axis.text.x = element_text(angle = 60, hjust=1))+
  geom_bar(stat="identity", position=position_dodge())
```

It appears that the level of satisfaction is pretty much the same for all the departments except for some unhappy folks in the accounting department. While rest of the departments average satisfaction value is around 60% (which comply with overall satisfaction rate of 61.28%), accounting department's mean is below the company's mean. May be we should focus to that department seperately.
```{r}
department_left_rate<-d %>%
  group_by(departments) %>%
  summarise (n = n()) %>%
  mutate(freq = n / sum(n))

department_left_rate


ggplot(department_left_rate, aes(x=department_left_rate$departments,y=department_left_rate$freq ))+
      theme(axis.text.x = element_text(angle = 60, hjust=1))+
      geom_bar(stat = "identity")

```

Notice that altough job satisfaction level is uniformly distributed among the departments, the left rate varies abrubtly, having a peak in the sales department. So there must be other factors that effect employee's decision to sign-out, such as salary.

Now, let's look at the categorical variables, salary and department name. We wanted to compare left and remained employee counts by departments and salary categories. When salary category does not give much insight about the characteristics of left people, we found that the 3 departments have considerably higher number of people left. These departments are sales, technical and support.
```{r}

p9 <- ggplot(d, aes(x=d$departments,fill=as.character(d$left) ))+
  theme(axis.text.x = element_text(angle = 60, hjust=1))+
  geom_bar()

p10 <- ggplot(d, aes(x=d$salary,fill=as.character(d$left) ))+
      geom_bar()
#ggtitle("Average bill for 2 people")

multiplot(p9,p10,cols=2)
```

